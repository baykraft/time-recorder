(this["webpackJsonptime-recorder-view"]=this["webpackJsonptime-recorder-view"]||[]).push([[0],{134:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(10),i=a.n(c),l=(a(99),a(43)),o=a(29),s=a(14),u=a(175),m=a(183),d=a(178),h=a(180),f=a(182),g=a(181),p=a(47),E=a.n(p),b=a(70),k=a.n(b),v=a(44),j=a(26),w=a(71),y=a(72),O=a(82),_=new(function(e){function t(){var e;return Object(v.a)(this,t),(e=Object(w.a)(this,Object(y.a)(t).call(this))).authenticated=!1,e.accessToken="",e.user={},e}return Object(O.a)(t,e),Object(j.a)(t,[{key:"isAuthenticated",value:function(){return this.authenticated}},{key:"setAuthenticated",value:function(e){this.authenticated=e,this.emit("change")}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"setAccessToken",value:function(e){this.accessToken=e,this.emit("change")}},{key:"getUser",value:function(){return this.user}},{key:"setUser",value:function(e){this.user=e,this.emit("change")}}]),t}(a(73).EventEmitter)),C=a(74),N=a.n(C),A=a(30),x=a.n(A),S=Object(u.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},slack:{width:32,height:32,marginRight:e.spacing(2)}}}));var T=function(){var e=S(),t=Object(n.useState)(!1),a=Object(s.a)(t,2),c=a[0],i=a[1];return Object(n.useEffect)((function(){_.on("change",(function(){i(_.isAuthenticated())}));var e=N.a.parse(window.location.search).code;void 0!==e&&x.a.get("https://slack.com/api/oauth.access",{params:{client_id:"3246745826.923685300119",client_secret:"0f959af4f1b0e43cd06a021d5390e188",code:e,redirect_uri:"https://baykraft-time-recorder.herokuapp.com/"}}).then((function(e){if(e.data.ok){var t=e.data.access_token,a=e.data.user_id;x.a.get("https://slack.com/api/users.info",{params:{token:t,user:a}}).then((function(e){e.data.ok&&(_.setUser(e.data.user),_.setAccessToken(t),_.setAuthenticated(!0))}))}}))}),[]),c?r.a.createElement(o.a,{to:"/timesheet"}):r.a.createElement("div",{className:e.root},r.a.createElement(d.a,{position:"static"},r.a.createElement(h.a,null,r.a.createElement(g.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(E.a,null)),r.a.createElement(f.a,{variant:"h6",className:e.title},"\u682a\u5f0f\u4f1a\u793e\u30d9\u30a4\u30af\u30e9\u30d5\u30c8"),r.a.createElement(m.a,{color:"inherit",onClick:function(){window.location="https://slack.com/oauth/authorize?client_id=".concat("3246745826.923685300119","&scope=users:read&redirect_uri=").concat("https://baykraft-time-recorder.herokuapp.com/")}},r.a.createElement("img",{src:k.a,className:e.slack,alt:"slack"}),"Login with Slack"))))},M=a(2);function D(e){var t=e.children,a=Object(M.a)(e,["children"]),c=Object(n.useState)(_.isAuthenticated()),i=Object(s.a)(c,1)[0];return r.a.createElement(o.b,Object.assign({},a,{render:function(e){var a=e.location;return i?t:r.a.createElement(o.a,{to:{pathname:"/",state:{from:a}}})}}))}var F=a(186),P=a(190),B=a(189),H=a(185),V=a(187),R=a(188),W=a(135),G=a(184),U=a(191),q=a(77),z=a.n(q),I=a(80),J=a.n(I),Y=a(78),L=a.n(Y),$=a(76),K=a(195),Q=a(192),X=a(194),Z=a(79),ee=a.n(Z),te=a(81),ae=a.n(te),ne=Object(u.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},userAvatar:{marginRight:e.spacing(2)},table:{minWidth:650,"& .MuiTableCell-root":{whiteSpace:"nowrap"}},container:{marginTop:e.spacing(2),marginBottom:e.spacing(2)},formContainer:{"& .MuiTextField-root":{margin:e.spacing(1),width:100},marginTop:e.spacing(2)},disableCell:{backgroundColor:"#efefef"},button:{margin:e.spacing(1)},holidayCell:{color:"#f44336",backgroundColor:"#efefef"},customerField:{width:50},dateField:{width:50},actions:{whiteSpace:"nowrap",textAlign:"right"}}})),re=["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"],ce={0:"",10:"\u6709\u4f11",11:"\u6709\u4f11(AM)",12:"\u6709\u4f11(PM)",20:"\u6b20\u52e4",21:"\u6b20\u52e4(AM)",22:"\u6b20\u52e4(PM)",30:"\u7279\u4f11",31:"\u7279\u4f11(AM)",32:"\u7279\u4f11(PM)",40:"\u4ee3\u4f11",41:"\u4ee3\u4f11(AM)",42:"\u4ee3\u4f11(PM)",50:"\u4f11\u51fa"};function ie(){var e=ne(),t=Object(n.useState)(_.getUser()),a=Object(s.a)(t,1)[0],c=Object(n.useState)((new Date).getFullYear()),i=Object(s.a)(c,2),l=i[0],o=i[1],u=Object(n.useState)((new Date).getMonth()+1),p=Object(s.a)(u,2),b=p[0],k=p[1],v=Object(n.useState)([]),j=Object(s.a)(v,2),w=j[0],y=j[1],O=Object(n.useState)("error"),C=Object(s.a)(O,2),N=C[0],A=C[1],S=Object(n.useState)(""),T=Object(s.a)(S,2),M=T[0],D=T[1],q=Object(n.useState)(!1),I=Object(s.a)(q,2),Y=I[0],Z=I[1],te=Object(n.useState)({}),ie=Object(s.a)(te,2),le=ie[0],oe=ie[1],se=function(e,t,a,n,r,c,i,l,o,s,u){return{edit:e,year:t,month:a,date:n,day:r,holiday:c,customer:i,kind:l,start_time:o,end_time:s,note:u}},ue=function(e){le.hasOwnProperty(String(e.date))||(le[String(e.date)]=Object.assign({},e))},me=function(){for(var e=[],t=0,a=Object.entries(ce);t<a.length;t++){var n=a[t],c=Object(s.a)(n,2),i=c[0],l=c[1];e.push(r.a.createElement("option",{key:i,value:i},l))}return e},de=function(e,t){"clickaway"!==t&&Z(!1)};return r.a.createElement("form",{className:e.root},r.a.createElement(d.a,{position:"sticky"},r.a.createElement(h.a,null,r.a.createElement(g.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(E.a,null)),r.a.createElement(f.a,{variant:"h6",className:e.title},"\u682a\u5f0f\u4f1a\u793e\u30d9\u30a4\u30af\u30e9\u30d5\u30c8"),r.a.createElement(m.a,{color:"inherit"},r.a.createElement(K.a,{alt:"avatar",src:a.profile.image_48,className:e.userAvatar}),a.profile.real_name))),r.a.createElement(X.a,{open:Y,autoHideDuration:6e3,onClose:de},r.a.createElement(Q.a,{severity:N,variant:"filled",onClose:de},M)),r.a.createElement(G.a,{maxWidth:"md",className:e.formContainer},r.a.createElement(U.a,{required:!0,label:"\u5e74",defaultValue:l,onChange:function(e){return o(e.target.value)}}),r.a.createElement(U.a,{required:!0,label:"\u6708",defaultValue:b,onChange:function(e){return k(e.target.value)}}),r.a.createElement(m.a,{variant:"contained",color:"primary",size:"large",className:e.button,startIcon:r.a.createElement(z.a,null),onClick:function(){return l?b?Number(l)<2020||Number(l)>(new Date).getFullYear()?(A("error"),D("\u5e74\u306f\u300c2020\u2266\u5165\u529b\u5e74\u2266\u73fe\u5728\u5e74\u300d\u306e\u7bc4\u56f2\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void Z(!0)):void x.a.get("https://baykraft-time-recorder.herokuapp.com/rest"+"/times/".concat(l,"/").concat(b),{params:{token:_.getAccessToken()}}).then((function(e){x.a.get("https://holidays-jp.github.io/api/v1/".concat(l,"/date.json")).then((function(t){for(var a=e.data.records,n=t.data,r=new Date(l,b-1,1),c=[],i=function(){var e=r.getDate(),t=r.getDay(),i="".concat(l,"-").concat(("0"+b).slice(-2),"-").concat(("0"+e).slice(-2)),o=0===t||6===t||i in n?"H":"",s=a.find((function(t){return t.date===e}));if(s?c.push(se(!1,l,b,e,re[t],o,s.customer,s.kind,s.start_time,s.end_time,s.note)):c.push(se(!1,l,b,e,re[t],o,"",0,"","",n[i])),r.setDate(e+1),Number(b)!==r.getMonth()+1)return"break"};;){if("break"===i())break}y(c),oe({})}))})):(A("error"),D("\u6708\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),void Z(!0)):(A("error"),D("\u5e74\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),void Z(!0))}},"\u691c\u7d22")),r.a.createElement(G.a,{maxWidth:"md",className:e.container},r.a.createElement(H.a,{component:W.a},r.a.createElement(F.a,{className:e.table,"aria-label":"timesheet"},r.a.createElement(V.a,null,r.a.createElement(R.a,null,r.a.createElement(B.a,{align:"center",component:"th",scope:"row"},"\u65e5\u4ed8"),r.a.createElement(B.a,{align:"center",component:"th"},"\u66dc\u65e5"),r.a.createElement(B.a,{align:"center",component:"th"},"\u4f11\u65e5"),r.a.createElement(B.a,{align:"center"},"\u5ba2\u5148"),r.a.createElement(B.a,{align:"center"},"\u52e4\u4f11"),r.a.createElement(B.a,{align:"center"},"\u59cb\u696d"),r.a.createElement(B.a,{align:"center"},"\u7d42\u696d"),r.a.createElement(B.a,null,"\u5099\u8003"),r.a.createElement(B.a,null))),r.a.createElement(P.a,null,w.map((function(t){return r.a.createElement(R.a,{key:t.date},r.a.createElement(B.a,{align:"center",className:e.disableCell},t.date),r.a.createElement(B.a,{align:"center",className:e.disableCell},t.day),r.a.createElement(B.a,{align:"center",className:e.holidayCell},t.holiday),r.a.createElement(B.a,{align:"center"},t.edit?r.a.createElement(U.a,{defaultValue:t.customer,className:e.customerField,inputProps:{style:{textAlign:"center"}},onChange:function(e){return function(e,t){ue(e),e.customer=t,y(w.slice())}(t,e.target.value)}}):r.a.createElement("span",null,t.customer)),r.a.createElement(B.a,{align:"center"},t.edit?r.a.createElement($.a,{value:t.kind,onChange:function(e){return function(e,t){ue(e),e.kind=t,y(w.slice())}(t,e.target.value)}},r.a.createElement(me,null)):r.a.createElement("span",null,ce[t.kind])),r.a.createElement(B.a,{align:"center"},t.edit?r.a.createElement(U.a,{defaultValue:t.start_time,className:e.dateField,inputProps:{style:{textAlign:"center"}},onChange:function(e){return function(e,t){ue(e),e.start_time=t,y(w.slice())}(t,e.target.value)}}):r.a.createElement("span",null,t.start_time)),r.a.createElement(B.a,{align:"center"},t.edit?r.a.createElement(U.a,{defaultValue:t.end_time,className:e.dateField,inputProps:{style:{textAlign:"center"}},onChange:function(e){return function(e,t){ue(e),e.end_time=t,y(w.slice())}(t,e.target.value)}}):r.a.createElement("span",null,t.end_time)),r.a.createElement(B.a,null,t.edit?r.a.createElement(U.a,{defaultValue:t.note,onChange:function(e){return function(e,t){ue(e),e.note=t,y(w.slice())}(t,e.target.value)}}):r.a.createElement("span",null,t.note)),r.a.createElement(B.a,{align:"center"},t.edit?r.a.createElement("div",{className:e.actions},r.a.createElement(g.a,{"aria-label":"done",onClick:function(){return function(e){var t=RegExp(/\d{1,2}:\d{1,2}/);if(e.start_time&&!t.test(e.start_time))return A("error"),D("\u59cb\u696d\u306f\u300cHH:mm\u300d\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void Z(!0);if(e.end_time&&!t.test(e.end_time))return A("error"),D("\u7d42\u696d\u306f\u300cHH:mm\u300d\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void Z(!0);var a=e.year,n=e.month,r=e.date;x.a.put("https://baykraft-time-recorder.herokuapp.com/rest"+"/times/".concat(a,"/").concat(n,"/").concat(r),{customer:e.customer,kind:e.kind,start_time:e.start_time,end_time:e.end_time,note:e.note},{params:{token:_.getAccessToken()}}).then((function(){e.edit=!1,y(w.slice()),A("success"),D("\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),Z(!0)}))}(t)}},r.a.createElement(L.a,null)),r.a.createElement(g.a,{"aria-label":"cancel",onClick:function(){return function(e){var t=le[String(e.date)];t&&(e.customer=t.customer,e.kind=t.kind,e.start_time=t.start_time,e.end_time=t.end_time,e.note=t.note,delete le[e.date],oe(le)),e.edit=!1,y(w.slice())}(t)}},r.a.createElement(ee.a,null))):r.a.createElement("div",{className:e.actions},r.a.createElement(g.a,{"aria-label":"edit",onClick:function(){return function(e){e.edit=!0,y(w.slice())}(t)}},r.a.createElement(J.a,null)),r.a.createElement(g.a,{"aria-label":"delete",sionClick:function(){return function(e){var t=e.year,a=e.month,n=e.date;x.a.delete("https://baykraft-time-recorder.herokuapp.com/rest"+"/times/".concat(t,"/").concat(a,"/").concat(n),{params:{token:_.getAccessToken()}}).then((function(){e.customer=null,e.kind=0,e.start_time=null,e.end_time=null,e.note=null,y(w.slice()),A("success"),D("\u524a\u9664\u3057\u307e\u3057\u305f\u3002"),Z(!0)}))}(t)}},r.a.createElement(ae.a,null)))))})))))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement((function(){return r.a.createElement(l.a,null,r.a.createElement(o.d,null,r.a.createElement(o.b,{exact:!0,path:"/"},r.a.createElement(T,null)),r.a.createElement(D,{exact:!0,path:"/timesheet"},r.a.createElement(ie,null))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},70:function(e,t,a){e.exports=a.p+"static/media/slack_icon.be396144.svg"},94:function(e,t,a){e.exports=a(134)},99:function(e,t,a){}},[[94,1,2]]]);
//# sourceMappingURL=main.79068127.chunk.js.map