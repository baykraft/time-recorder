(this["webpackJsonptime-recorder-view"]=this["webpackJsonptime-recorder-view"]||[]).push([[0],{116:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),i=a.n(c),l=(a(81),a(32)),o=a(25),s=a(15),u=a(148),m=a(156),h=a(151),d=a(153),g=a(155),f=a(154),E=a(36),p=a.n(E),b=a(56),k=a.n(b),v=a(33),w=a(22),j=a(57),O=a(58),y=a(63),N=new(function(e){function t(){var e;return Object(v.a)(this,t),(e=Object(j.a)(this,Object(O.a)(t).call(this))).authenticated=!1,e.accessToken="",e.user={},e}return Object(y.a)(t,e),Object(w.a)(t,[{key:"isAuthenticated",value:function(){return this.authenticated}},{key:"setAuthenticated",value:function(e){this.authenticated=e,this.emit("change")}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"setAccessToken",value:function(e){this.accessToken=e,this.emit("change")}},{key:"getUser",value:function(){return this.user}},{key:"setUser",value:function(e){this.user=e,this.emit("change")}}]),t}(a(59).EventEmitter)),x=a(60),T=a.n(x),_=a(30),A=a.n(_),S=Object(u.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},slack:{width:32,height:32,marginRight:e.spacing(2)}}}));var C=function(){var e=S(),t=Object(n.useState)(!1),a=Object(s.a)(t,2),c=a[0],i=a[1];return Object(n.useEffect)((function(){N.on("change",(function(){i(N.isAuthenticated())}));var e=T.a.parse(window.location.search).code;void 0!==e&&A.a.get("https://slack.com/api/oauth.access",{params:{client_id:"3246745826.923685300119",client_secret:"0f959af4f1b0e43cd06a021d5390e188",code:e,redirect_uri:"https://baykraft-time-recorder.herokuapp.com/"}}).then((function(e){if(e.data.ok){var t=e.data.access_token,a=e.data.user_id;A.a.get("https://slack.com/api/users.info",{params:{token:t,user:a}}).then((function(e){e.data.ok&&(N.setUser(e.data.user),N.setAccessToken(t),N.setAuthenticated(!0))}))}}))}),[]),c?r.a.createElement(o.a,{to:"/timesheet"}):r.a.createElement("div",{className:e.root},r.a.createElement(h.a,{position:"static"},r.a.createElement(d.a,null,r.a.createElement(f.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(p.a,null)),r.a.createElement(g.a,{variant:"h6",className:e.title},"\u682a\u5f0f\u4f1a\u793e\u30d9\u30a4\u30af\u30e9\u30d5\u30c8"),r.a.createElement(m.a,{color:"inherit",onClick:function(){window.location="https://slack.com/oauth/authorize?client_id=".concat("3246745826.923685300119","&scope=users:read&redirect_uri=").concat("https://baykraft-time-recorder.herokuapp.com/")}},r.a.createElement("img",{src:k.a,className:e.slack,alt:"slack"}),"Login with Slack"))))},B=a(2);function D(e){var t=e.children,a=Object(B.a)(e,["children"]),c=Object(n.useState)(N.isAuthenticated()),i=Object(s.a)(c,1)[0];return r.a.createElement(o.b,Object.assign({},a,{render:function(e){var a=e.location;return i?t:r.a.createElement(o.a,{to:{pathname:"/",state:{from:a}}})}}))}var R=a(159),W=a(163),G=a(162),I=a(158),U=a(160),F=a(161),M=a(117),q=a(157),z=a(164),J=a(62),V=a.n(J),Y=Object(u.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},userIcon:{borderRadius:5,marginRight:e.spacing(2)},table:{minWidth:650},container:{marginTop:e.spacing(2),marginBottom:e.spacing(2)},formContainer:{"& .MuiTextField-root":{margin:e.spacing(1),width:200},marginTop:e.spacing(2)},noteCell:{width:200},button:{margin:e.spacing(1)},holiday:{color:"#f44336"}}})),H=["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"];function L(){var e=Y(),t=Object(n.useState)(N.getUser()),a=Object(s.a)(t,1)[0],c=Object(n.useState)((new Date).getFullYear()),i=Object(s.a)(c,2),l=i[0],o=i[1],u=Object(n.useState)((new Date).getMonth()+1),E=Object(s.a)(u,2),b=E[0],k=E[1],v=Object(n.useState)([]),w=Object(s.a)(v,2),j=w[0],O=w[1],y=Object(n.useState)(""),x=Object(s.a)(y,2),T=x[0],_=x[1],S=Object(n.useState)(""),C=Object(s.a)(S,2),B=C[0],D=C[1],J=function(e,t,a,n,r,c,i,l){return{date:e,day:t,holiday:a,customer:n,kind:r,start:c,end:i,note:l}};return r.a.createElement("form",{className:e.root},r.a.createElement(h.a,{position:"sticky"},r.a.createElement(d.a,null,r.a.createElement(f.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(p.a,null)),r.a.createElement(g.a,{variant:"h6",className:e.title},"\u682a\u5f0f\u4f1a\u793e\u30d9\u30a4\u30af\u30e9\u30d5\u30c8"),r.a.createElement(m.a,{color:"inherit"},r.a.createElement("img",{src:a.profile.image_32,className:e.userIcon,alt:"icon"}),a.profile.real_name))),r.a.createElement(q.a,{maxWidth:"md",className:e.formContainer},r.a.createElement(z.a,{required:!0,error:0!==T.length,label:"\u5e74",defaultValue:l,helperText:T,onChange:function(e){o(e.target.value)}}),r.a.createElement(z.a,{required:!0,error:0!==B.length,label:"\u6708",defaultValue:b,helperText:B,onChange:function(e){k(e.target.value)}}),r.a.createElement(m.a,{variant:"contained",color:"primary",size:"large",className:e.button,startIcon:r.a.createElement(V.a,null),onClick:function(){if(_(""),D(""),0===l.length||0===b.length)return _(0===l.length?"\u5fc5\u9808\u5165\u529b":""),void D(0===b.length?"\u5fc5\u9808\u5165\u529b":"");Number(l)<2020||Number(l)>(new Date).getFullYear()?_("2020\u2266\u5165\u529b\u5e74\u2266\u73fe\u5728\u5e74"):A.a.get("https://baykraft-time-recorder.herokuapp.com/rest"+"/".concat(l,"/").concat(b,"/times"),{params:{token:N.getAccessToken()}}).then((function(e){for(var t=e.data,a=new Date(l,b-1,1),n=[],r=function(){var e=a.getDate(),r=a.getDay(),c=0===r||6===r?"H":"",i=t.find((function(t){return t.date===e}));if(i?n.push(J(e,H[r],c,"","",i.start,i.end,i.note)):n.push(J(e,H[r],c,"","","","")),a.setDate(e+1),Number(b)!==a.getMonth()+1)return"break"};;){if("break"===r())break}O(n)}))}},"\u691c\u7d22")),r.a.createElement(q.a,{maxWidth:"md",className:e.container},r.a.createElement(I.a,{component:M.a},r.a.createElement(R.a,{className:e.table,"aria-label":"timesheet"},r.a.createElement(U.a,null,r.a.createElement(F.a,null,r.a.createElement(G.a,{align:"center",component:"th",scope:"row"},"\u65e5\u4ed8"),r.a.createElement(G.a,{align:"center"},"\u66dc\u65e5"),r.a.createElement(G.a,{align:"center"},"\u4f11\u65e5"),r.a.createElement(G.a,{align:"center"},"\u5ba2\u5148"),r.a.createElement(G.a,{align:"center"},"\u52e4\u4f11"),r.a.createElement(G.a,{align:"center"},"\u59cb\u696d"),r.a.createElement(G.a,{align:"center"},"\u7d42\u696d"),r.a.createElement(G.a,{className:e.noteCell},"\u5099\u8003"))),r.a.createElement(W.a,null,j.map((function(t){return r.a.createElement(F.a,{key:t.date},r.a.createElement(G.a,{align:"center"},t.date),r.a.createElement(G.a,{align:"center"},t.day),r.a.createElement(G.a,{align:"center",className:e.holiday},t.holiday),r.a.createElement(G.a,{align:"center"},t.customer),r.a.createElement(G.a,{align:"center"},t.kind),r.a.createElement(G.a,{align:"center"},t.start),r.a.createElement(G.a,{align:"center"},t.end),r.a.createElement(G.a,null,t.note))})))))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement((function(){return r.a.createElement(l.a,null,r.a.createElement(o.d,null,r.a.createElement(o.b,{exact:!0,path:"/"},r.a.createElement(C,null)),r.a.createElement(D,{path:"/timesheet"},r.a.createElement(L,null))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},56:function(e,t,a){e.exports=a.p+"static/media/slack_icon.be396144.svg"},76:function(e,t,a){e.exports=a(116)},81:function(e,t,a){}},[[76,1,2]]]);
//# sourceMappingURL=main.8fcbc8dc.chunk.js.map